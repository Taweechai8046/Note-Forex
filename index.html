<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Forex Profit Journal</title>
  <link rel="shortcut icon" href="icons/ChatGPT.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="theme-color" content="#d4ad42">

  <!-- Manifest -->
  <script type="application/manifest+json">
  {
    "name": "Forex Profit Journal",
    "short_name": "Forex Journal",
    "description": "‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≥‡πÑ‡∏£ Forex ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ",
    "start_url": "./index.html",
    "display": "standalone",
    "background_color": "#000000",
    "theme_color": "#d4ad42",
    "orientation": "portrait",
    "icons": [
      {"src": "ChatGPT.png","sizes": "192x192","type": "image/png"},
      {"src": "ChatGPT.png","sizes": "512x512","type": "image/png"}
    ]
  }
  </script>
  <style>
    body { font-family: "Kanit", sans-serif; }
    .scrollable-table { overflow-x: auto; }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-black text-yellow-500 p-4 flex justify-between items-center shadow-md">
    <h1 class="text-lg font-bold">üìä Forex Profit Journal</h1>
    <button id="toggleTheme" class="bg-yellow-500 text-black px-3 py-1 rounded-lg">üåô</button>
  </header>

  <main class="flex-1 container mx-auto p-3 space-y-4">
    <!-- Form -->
    <form id="tradeForm" class="grid gap-2 sm:grid-cols-2">
      <input class="border p-2 rounded w-full" name="pair" placeholder="‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏ä‡πà‡∏ô EURUSD" required>
      <input class="border p-2 rounded w-full" name="lot" type="number" step="0.01" placeholder="‡∏Ç‡∏ô‡∏≤‡∏î Lot" required>
      <input class="border p-2 rounded w-full" name="pips" type="number" step="0.1" placeholder="Pips" required>
      <input class="border p-2 rounded w-full" name="profit" type="number" step="0.01" placeholder="‡∏Å‡∏≥‡πÑ‡∏£ ($)" required>
      <button class="bg-yellow-500 text-black font-bold py-2 px-4 rounded col-span-full">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    </form>

    <!-- Table -->
    <div class="scrollable-table">
      <table class="w-full border-collapse text-sm">
        <thead class="bg-yellow-500 text-black">
          <tr>
            <th class="p-2 border">‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô</th>
            <th class="p-2 border">Lot</th>
            <th class="p-2 border">Pips</th>
            <th class="p-2 border">‡∏Å‡∏≥‡πÑ‡∏£ ($)</th>
            <th class="p-2 border">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="tradeTable" class="bg-white"></tbody>
      </table>
    </div>

    <!-- Summary -->
    <div class="p-3 bg-black text-yellow-500 rounded-lg">
      <p>‡∏£‡∏ß‡∏°‡∏Å‡∏≥‡πÑ‡∏£: <span id="totalProfit">0</span> $</p>
      <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á: <span id="totalTrades">0</span></p>
      <p>Win Rate: <span id="winRate">0</span>%</p>
      <p>Expectancy: <span id="expectancy">0</span></p>
    </div>

    <!-- Chart -->
    <div class="bg-white p-3 rounded-lg shadow">
      <canvas id="profitChart"></canvas>
    </div>

    <!-- Buttons -->
    <div class="flex gap-2">
      <button id="exportCSV" class="flex-1 bg-green-500 text-white p-2 rounded">‚¨áÔ∏è ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
      <button id="importCSV" class="flex-1 bg-blue-500 text-white p-2 rounded">‚¨ÜÔ∏è ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ CSV</button>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-black text-yellow-500 text-center p-2 text-xs">
    ¬© 2025 Forex Journal ‚Äì ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ (PWA)
  </footer>

  <!-- Script -->
  <script>
    const form = document.getElementById("tradeForm");
    const table = document.getElementById("tradeTable");
    const totalProfitEl = document.getElementById("totalProfit");
    const totalTradesEl = document.getElementById("totalTrades");
    const winRateEl = document.getElementById("winRate");
    const expectancyEl = document.getElementById("expectancy");
    const ctx = document.getElementById("profitChart").getContext("2d");

    let trades = JSON.parse(localStorage.getItem("trades") || "[]");
    let chart = new Chart(ctx, {
      type: "line",
      data: { labels: [], datasets: [{label:"‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∞‡∏™‡∏° ($)", data:[], borderWidth:2}] },
      options: { responsive:true, maintainAspectRatio:false }
    });

    function render() {
      table.innerHTML = "";
      let total = 0, wins=0;
      trades.forEach((t,i)=>{
        total += t.profit;
        if(t.profit>0) wins++;
        table.innerHTML += `
          <tr class="text-center">
            <td class="border p-1">${t.pair}</td>
            <td class="border p-1">${t.lot}</td>
            <td class="border p-1">${t.pips}</td>
            <td class="border p-1 ${t.profit>=0?"text-green-600":"text-red-600"}">${t.profit}</td>
            <td class="border p-1">
              <button onclick="editTrade(${i})" class="text-blue-500">‚úèÔ∏è</button>
              <button onclick="deleteTrade(${i})" class="text-red-500">üóëÔ∏è</button>
            </td>
          </tr>`;
      });
      totalProfitEl.textContent = total.toFixed(2);
      totalTradesEl.textContent = trades.length;
      winRateEl.textContent = trades.length ? ((wins/trades.length)*100).toFixed(1) : 0;
      expectancyEl.textContent = trades.length ? (total/trades.length).toFixed(2) : 0;
      localStorage.setItem("trades", JSON.stringify(trades));

      chart.data.labels = trades.map((_,i)=>i+1);
      chart.data.datasets[0].data = trades.reduce((acc,t,i)=>{
        acc.push((acc[i-1]||0)+t.profit); return acc;
      },[]);
      chart.update();
    }

    form.onsubmit = e=>{
      e.preventDefault();
      const fd = new FormData(form);
      trades.push({
        pair:fd.get("pair"), lot:+fd.get("lot"), pips:+fd.get("pips"), profit:+fd.get("profit")
      });
      form.reset();
      render();
    };

    function deleteTrade(i){
      if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")){ trades.splice(i,1); render(); }
    }
    function editTrade(i){
      const t = trades[i];
      const profit = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≥‡πÑ‡∏£:", t.profit);
      if(profit!==null){ trades[i].profit=+profit; render(); }
    }

    // CSV
    document.getElementById("exportCSV").onclick=()=>{
      let csv="Pair,Lot,Pips,Profit\n"+trades.map(t=>`${t.pair},${t.lot},${t.pips},${t.profit}`).join("\n");
      const blob=new Blob([csv],{type:"text/csv"});
      const url=URL.createObjectURL(blob);
      const a=document.createElement("a");
      a.href=url; a.download="trades.csv"; a.click();
    };

    document.getElementById("importCSV").onclick=()=>{
      const inp=document.createElement("input");
      inp.type="file"; inp.accept=".csv";
      inp.onchange=()=>{
        const file=inp.files[0];
        const reader=new FileReader();
        reader.onload=e=>{
          const lines=e.target.result.split("\n").slice(1);
          trades=lines.filter(l=>l).map(l=>{
            const [pair,lot,pips,profit]=l.split(",");
            return {pair,lot:+lot,pips:+pips,profit:+profit};
          });
          render();
        };
        reader.readAsText(file);
      };
      inp.click();
    };

    // Theme toggle
    const toggleBtn=document.getElementById("toggleTheme");
    toggleBtn.onclick=()=>{
      document.body.classList.toggle("bg-gray-900");
      document.body.classList.toggle("text-white");
    };

    render();

    // Service Worker inline
    const swCode=`self.addEventListener("install",e=>{self.skipWaiting()});`;
    if("serviceWorker" in navigator){
      const blob=new Blob([swCode],{type:"text/javascript"});
      const swURL=URL.createObjectURL(blob);
      navigator.serviceWorker.register(swURL);
    }
  </script>
</body>
</html>
